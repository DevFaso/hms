<div class="rw-page">
  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  @if (pageState === 'loading') {
    <div class="rw-card rw-card--centered">
      <div class="rw-spinner" aria-label="Loading"></div>
      <p class="rw-muted">Loading your assignment details‚Ä¶</p>
    </div>
  }

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ NOT FOUND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  @if (pageState === 'not-found') {
    <div class="rw-card rw-card--centered">
      <div class="rw-icon rw-icon--warn">‚ö†Ô∏è</div>
      <h1 class="rw-title">Link not found</h1>
      <p class="rw-body">{{ errorMessage }}</p>
      <button class="rw-btn rw-btn--primary" (click)="goToLogin()">Go to Login</button>
    </div>
  }

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ERROR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  @if (pageState === 'error') {
    <div class="rw-card rw-card--centered">
      <div class="rw-icon rw-icon--error">‚úï</div>
      <h1 class="rw-title">Something went wrong</h1>
      <p class="rw-body">{{ errorMessage }}</p>
      <button class="rw-btn rw-btn--primary" (click)="goToLogin()">Go to Login</button>
    </div>
  }

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ALREADY VERIFIED ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  @if (pageState === 'already-verified' && assignment) {
    <div class="rw-card rw-card--centered">
      <div class="rw-icon rw-icon--success">‚úì</div>
      <h1 class="rw-title">Already Confirmed</h1>
      <p class="rw-body">
        Your assignment as <strong>{{ assignment.roleName }}</strong>
        @if (assignment.hospitalName) {
          at <strong>{{ assignment.hospitalName }}</strong>
        }
        was already confirmed. Your access is active.
      </p>
      <button class="rw-btn rw-btn--primary" (click)="goToLogin()">Go to Login</button>
    </div>
  }

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MAIN FORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  @if (pageState === 'loaded' && assignment) {
    <div class="rw-card">
      <!-- Header -->
      <div class="rw-header">
        <div class="rw-logo-area">
          <div class="rw-logo-badge">HMS</div>
        </div>
        <h1 class="rw-title">Welcome, {{ assignment.assigneeName }}!</h1>
        <p class="rw-subtitle">You've been assigned a new role in the system</p>
      </div>

      <!-- Role / Hospital info -->
      <div class="rw-info-grid">
        <div class="rw-info-item">
          <span class="rw-info-label">Role</span>
          <span class="rw-info-value">{{ assignment.roleName }}</span>
        </div>
        @if (assignment.hospitalName) {
          <div class="rw-info-item">
            <span class="rw-info-label">Organization</span>
            <span class="rw-info-value">{{ assignment.hospitalName }}</span>
          </div>
        }
        @if (assignment.hospitalAddress) {
          <div class="rw-info-item">
            <span class="rw-info-label">Location</span>
            <span class="rw-info-value">{{ assignment.hospitalAddress }}</span>
          </div>
        }
        @if (assignment.roleDescription) {
          <div class="rw-info-item rw-info-item--full">
            <span class="rw-info-label">About this role</span>
            <span class="rw-info-value">{{ assignment.roleDescription }}</span>
          </div>
        }
      </div>

      <!-- Profile checklist -->
      @if (assignment.profileChecklist && assignment.profileChecklist.length > 0) {
        <div class="rw-checklist">
          <h2 class="rw-checklist__title">What you'll be able to do</h2>
          <ul class="rw-checklist__list">
            @for (item of assignment.profileChecklist; track item) {
              <li class="rw-checklist__item">
                <span class="rw-checklist__bullet" aria-hidden="true">‚Ä∫</span>
                <span>{{ item }}</span>
              </li>
            }
          </ul>
        </div>
      }

      <!-- Verification section -->
      <div class="rw-verify">
        <h2 class="rw-verify__title">Confirm your assignment</h2>
        <p class="rw-verify__hint">
          Enter the 6-digit confirmation code from your email to activate your access.
        </p>

        <!-- Digit inputs -->
        <div class="rw-digits" (paste)="onDigitPaste($event)">
          @for (digit of digits; track $index; let i = $index) {
            <input
              #digitInput
              class="rw-digit"
              type="text"
              inputmode="numeric"
              maxlength="1"
              placeholder="¬∑"
              [title]="'Digit ' + (i + 1) + ' of 6'"
              [attr.aria-label]="'Digit ' + (i + 1) + ' of 6'"
              [value]="digit"
              [disabled]="verifying"
              (input)="onDigitInput($event, i)"
              (keydown)="onDigitKeydown($event, i)"
            />
          }
        </div>

        <!-- Error message -->
        @if (verifyError) {
          <div class="rw-error" role="alert">{{ verifyError }}</div>
        }

        <!-- Submit button -->
        <button
          class="rw-btn rw-btn--primary rw-btn--full"
          [disabled]="!isCodeComplete || verifying"
          (click)="submitCode()"
        >
          @if (verifying) {
            <span class="rw-btn-spinner"></span>
            Verifying‚Ä¶
          } @else {
            Confirm & Activate Access
          }
        </button>
      </div>
    </div>
  }

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SUCCESS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  @if (pageState === 'success' && assignment) {
    <div class="rw-card rw-card--centered">
      <div class="rw-icon rw-icon--success">‚úì</div>
      <h1 class="rw-title">Access Activated!</h1>
      <p class="rw-body">
        Your role as <strong>{{ assignment.roleName }}</strong>
        @if (assignment.hospitalName) {
          at <strong>{{ assignment.hospitalName }}</strong>
        }
        is now active.
      </p>

      <!-- Temporary credentials block ‚Äî only shown for brand-new users -->
      @if (assignment.tempUsername && assignment.tempPassword) {
        <div class="rw-credentials-box">
          <div class="rw-credentials-icon">üîë</div>
          <h2 class="rw-credentials-title">Your Login Credentials</h2>
          <p class="rw-credentials-hint">
            Use these temporary credentials to log in for the first time.<br />
            You will be asked to set a new password immediately after signing in.
          </p>
          <div class="rw-credentials-grid">
            <div class="rw-credentials-item">
              <span class="rw-credentials-label">Username</span>
              <div class="rw-credentials-value-row">
                <span class="rw-credentials-value">{{ assignment.tempUsername }}</span>
                <button
                  class="rw-copy-btn"
                  [class.rw-copy-btn--copied]="copiedUsername"
                  (click)="copyToClipboard(assignment.tempUsername!, 'username')"
                  [title]="copiedUsername ? 'Copied!' : 'Copy username'"
                  type="button"
                >
                  {{ copiedUsername ? '‚úì Copied' : 'Copy' }}
                </button>
              </div>
            </div>
            <div class="rw-credentials-item">
              <span class="rw-credentials-label">Temporary Password</span>
              <div class="rw-credentials-value-row">
                <span class="rw-credentials-value">{{ assignment.tempPassword }}</span>
                <button
                  class="rw-copy-btn"
                  [class.rw-copy-btn--copied]="copiedPassword"
                  (click)="copyToClipboard(assignment.tempPassword!, 'password')"
                  [title]="copiedPassword ? 'Copied!' : 'Copy password'"
                  type="button"
                >
                  {{ copiedPassword ? '‚úì Copied' : 'Copy' }}
                </button>
              </div>
            </div>
          </div>
          <p class="rw-credentials-warn">
            ‚ö†Ô∏è These credentials are shown only once. Screenshot or copy them before continuing.
          </p>
        </div>
      } @else {
        <p class="rw-body">You can now log in with your existing credentials.</p>
      }

      <button class="rw-btn rw-btn--primary" (click)="goToLogin()">Continue to Login ‚Üí</button>
    </div>
  }
</div>
