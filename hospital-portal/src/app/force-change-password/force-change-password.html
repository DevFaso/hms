<div class="fcp-page">
  <div class="fcp-card">
    @if (success()) {
      <!-- â”€â”€ Success state â”€â”€ -->
      <div class="fcp-success">
        <div class="fcp-success-icon">âœ…</div>
        <h1 class="fcp-title">Password Updated!</h1>
        <p class="fcp-body">
          Your password has been changed successfully. Redirecting you to the dashboardâ€¦
        </p>
      </div>
    } @else {
      <!-- â”€â”€ Form state â”€â”€ -->
      <div class="fcp-header">
        <div class="fcp-lock-icon">ğŸ”</div>
        <h1 class="fcp-title">Set Your Password</h1>
        <p class="fcp-subtitle">
          Your account was created with a temporary password.<br />
          Please set a new password to continue.
        </p>
      </div>

      @if (error()) {
        <div class="fcp-alert fcp-alert-error" role="alert">
          {{ error() }}
        </div>
      }

      <form (ngSubmit)="submit()" #changeForm="ngForm" novalidate>
        <!-- Current (temporary) password -->
        <div class="fcp-field">
          <label class="fcp-label" for="currentPwd">Temporary Password</label>
          <div class="fcp-input-wrap">
            <input
              id="currentPwd"
              class="fcp-input"
              [type]="showCurrent ? 'text' : 'password'"
              name="currentPassword"
              [(ngModel)]="currentPassword"
              placeholder="Enter your temporary password"
              required
            />
            <button
              type="button"
              class="fcp-eye-btn"
              (click)="showCurrent = !showCurrent"
              [attr.aria-label]="showCurrent ? 'Hide password' : 'Show password'"
            >
              {{ showCurrent ? 'ğŸ™ˆ' : 'ğŸ‘' }}
            </button>
          </div>
        </div>

        <!-- New password -->
        <div class="fcp-field">
          <label class="fcp-label" for="newPwd">New Password</label>
          <div class="fcp-input-wrap">
            <input
              id="newPwd"
              class="fcp-input"
              [type]="showNew ? 'text' : 'password'"
              name="newPassword"
              [(ngModel)]="newPassword"
              placeholder="At least 8 characters"
              minlength="8"
              required
            />
            <button
              type="button"
              class="fcp-eye-btn"
              (click)="showNew = !showNew"
              [attr.aria-label]="showNew ? 'Hide password' : 'Show password'"
            >
              {{ showNew ? 'ğŸ™ˆ' : 'ğŸ‘' }}
            </button>
          </div>
          @if (newPassword.length > 0 && !newPasswordValid) {
            <span class="fcp-hint fcp-hint-error">Must be at least 8 characters</span>
          }
        </div>

        <!-- Confirm new password -->
        <div class="fcp-field">
          <label class="fcp-label" for="confirmPwd">Confirm New Password</label>
          <div class="fcp-input-wrap">
            <input
              id="confirmPwd"
              class="fcp-input"
              [type]="showConfirm ? 'text' : 'password'"
              name="confirmPassword"
              [(ngModel)]="confirmPassword"
              placeholder="Repeat your new password"
              required
            />
            <button
              type="button"
              class="fcp-eye-btn"
              (click)="showConfirm = !showConfirm"
              [attr.aria-label]="showConfirm ? 'Hide password' : 'Show password'"
            >
              {{ showConfirm ? 'ğŸ™ˆ' : 'ğŸ‘' }}
            </button>
          </div>
          @if (confirmPassword.length > 0 && !passwordsMatch) {
            <span class="fcp-hint fcp-hint-error">Passwords do not match</span>
          }
        </div>

        <button type="submit" class="fcp-btn fcp-btn-primary" [disabled]="loading()">
          @if (loading()) {
            <span class="fcp-spinner"></span> Savingâ€¦
          } @else {
            Set New Password
          }
        </button>
      </form>

      <div class="fcp-footer">
        <button type="button" class="fcp-link-btn" (click)="logout()">
          Sign out and log in as a different user
        </button>
      </div>
    }
  </div>
</div>
