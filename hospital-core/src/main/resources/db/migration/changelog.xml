<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <!-- =================================================================
         V1: Complete schema — all 10 schemas + 153 tables
         Generated from Hibernate entity model to ensure 1:1 alignment
         ================================================================= -->
    <changeSet id="V1-initial-schema" author="hms-team" runOnChange="false">
        <sqlFile path="V1__Initial_Schema.sql"
                 relativeToChangelogFile="true"
                 splitStatements="true"
                 stripComments="true"/>
    </changeSet>

    <!-- =================================================================
         V1.1: Unique constraints omitted by Hibernate SchemaExport
         Required before V2 (ON CONFLICT (code) needs unique index)
         ================================================================= -->
    <changeSet id="V1.1-add-unique-constraints" author="hms-team" runOnChange="false">
        <sqlFile path="V1_1__add_unique_constraints.sql"
                 relativeToChangelogFile="true"
                 splitStatements="true"
                 stripComments="true"/>
    </changeSet>

    <!-- =================================================================
         V2: Seed 24 role codes (reference data required at bootstrap)
         ================================================================= -->
    <changeSet id="V2-seed-roles" author="hms-team" runOnChange="false">
        <sqlFile path="V2__seed_roles.sql"
                 relativeToChangelogFile="true"
                 splitStatements="true"
                 stripComments="false"/>
    </changeSet>

    <!-- =================================================================
         V3: Seed DEFAULT_ORG + 6 security policies + security rules
         ================================================================= -->
    <changeSet id="V3-seed-default-org-security" author="hms-team" runOnChange="false">
        <sqlFile path="V3__seed_default_organization_security.sql"
                 relativeToChangelogFile="true"
                 splitStatements="false"
                 stripComments="false"/>
    </changeSet>

    <!-- =================================================================
         V4: Make hospital.staff.license_number nullable
         Non-clinical staff (RECEPTIONIST, ADMIN, etc.) do not hold a
         medical licence. Clinical-role validation is enforced at the
         application layer (StaffServiceImpl.validateLicenseNumber).
         ================================================================= -->
    <changeSet id="V4-staff-license-number-nullable" author="hms-team" runOnChange="false">
        <sqlFile path="V4__staff_license_number_nullable.sql"
                 relativeToChangelogFile="true"
                 splitStatements="true"
                 stripComments="true"/>
    </changeSet>

    <!-- =================================================================
         V5: Add temp_plain_password to user_role_hospital_assignment
         Stores the one-time plaintext temp credential for new staff users;
         cleared (set to NULL) immediately after first successful
         verifyAssignmentByCode call — never retained long-term.
         ================================================================= -->
    <changeSet id="V5-add-temp-plain-password" author="hms-team" runOnChange="false">
        <sqlFile path="V5__add_temp_plain_password.sql"
                 relativeToChangelogFile="true"
                 splitStatements="true"
                 stripComments="true"/>
    </changeSet>

</databaseChangeLog>
